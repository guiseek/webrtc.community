(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{swqP:function(e,t,o){"use strict";o.r(t),o.d(t,"MungeSdpModule",function(){return Q});var n=o("MAu8"),i=o("d3UM"),a=o("bTqV"),r=o("/t3+"),c=o("GU7r"),s=o("fXoL"),l=o("FKr1"),d=(o("8LU1"),o("3Pt+"));o("R1ws"),o("u47x");let h=(()=>{class e{}return e.\u0275mod=s.Jb({type:e}),e.\u0275inj=s.Ib({factory:function(t){return new(t||e)}}),e})(),u=(()=>{class e{}return e.\u0275mod=s.Jb({type:e}),e.\u0275inj=s.Ib({factory:function(t){return new(t||e)},imports:[[h,l.m,l.e,c.c],h,l.e]}),e})();var b=o("ofXK"),f=o("Qu3c"),C=o("XNiG"),p=o("kmnG");let g=(()=>{class e{constructor(){this.changes=new C.a,this.itemsPerPageLabel="Items per page:",this.nextPageLabel="Next page",this.previousPageLabel="Previous page",this.firstPageLabel="First page",this.lastPageLabel="Last page",this.getRangeLabel=(e,t,o)=>{if(0==o||0==t)return"0 of "+o;const n=e*t;return`${n+1} \u2013 ${n<(o=Math.max(o,0))?Math.min(n+t,o):n+t} of ${o}`}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Object(s.Hb)({factory:function(){return new e},token:e,providedIn:"root"}),e})();const m={provide:g,deps:[[new s.A,new s.J,g]],useFactory:function(e){return e||new g}};let v=(()=>{class e{}return e.\u0275mod=s.Jb({type:e}),e.\u0275inj=s.Ib({factory:function(t){return new(t||e)},providers:[m],imports:[[b.c,a.c,i.b,f.b,l.e]]}),e})();var P=o("Wp6s"),S=o("qFsG"),w=o("tyNb"),O=o("mrSG"),y=o("sl1n");const M=["getMediaButtonRefButton"],R=["createPeerConnectionRefButton"],k=["createOfferRefButton"],B=["setOfferRefButton"],x=["createAnswerRefButton"],D=["setAnswerRefButton"],_=["hangupRefButton"],j=["localVideoRefEl"],A=["remoteVideoRefEl"],V=["selectSource"];let I=(()=>{class e{constructor(){this.offerSdp=new d.d,this.answerSdp=new d.d,this.audioSource=new d.d,this.videoSource=new d.d,this.dataChannelOptions={ordered:!0},this.dataChannelCounter=0,this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.gotRemoteStream=e=>{console.log(this.remoteVideo),console.log(this.remoteVideoRef.nativeElement),this.remoteVideo||(this.remoteVideo=this.remoteVideoRef.nativeElement),this.remoteVideo.srcObject!==e.streams[0]&&(this.remoteVideo.srcObject=e.streams[0],console.log("Fluxo remoto recebido"))},this.onIceCandidate=(e,t)=>Object(O.a)(this,void 0,void 0,function*(){try{t.candidate&&(yield this.getOtherPc(e).addIceCandidate(t.candidate)),this.onAddIceCandidateSuccess(e)}catch(o){this.onAddIceCandidateError(e,o)}console.log(`${this.getName(e)} Candidato ICE:\n${t.candidate?t.candidate.candidate:"(null)"}`)}),this.receiveChannelCallback=e=>{console.log("Receber retorno de chamada do canal"),this.receiveChannel=e.channel,this.receiveChannel.onmessage=this.onReceiveMessageCallback,this.receiveChannel.onopen=this.onReceiveChannelStateChange,this.receiveChannel.onclose=this.onReceiveChannelStateChange},this.onReceiveMessageCallback=e=>{this.dataChannelDataReceived=e.data,console.log("Contador de recebimento DataChannel: "+this.dataChannelDataReceived)},this.onSendChannelStateChange=()=>{const e=this.sendChannel.readyState;console.log("O estado do canal de envio \xe9: "+e),"open"===e?this.sendDataLoop=window.setInterval(this.sendData,1e3):clearInterval(this.sendDataLoop)},this.onReceiveChannelStateChange=()=>{console.log("O estado do canal de recep\xe7\xe3o \xe9: "+this.receiveChannel.readyState)}}ngOnInit(){return Object(O.a)(this,void 0,void 0,function*(){})}ngAfterViewInit(){this.localVideo=this.localVideoRef.nativeElement,this.remoteVideo=this.remoteVideoRef.nativeElement}getMedia(){return Object(O.a)(this,void 0,void 0,function*(){this.getMediaButton.disabled=!0,this.createPeerConnectionButton.disabled=!1,this.localVideo.muted=!0,this.localStream&&(this.localVideo.srcObject=null,this.localStream.getTracks().forEach(e=>e.stop()));const e=this.audioSource.value;console.log("Fonte de \xe1udio selecionada: "+e);const t=this.videoSource.value;console.log("Fonte de v\xeddeo selecionada: "+t);const o={audio:{optional:[{sourceId:e}]},video:{optional:[{sourceId:t}]}};console.log("Solicitou fluxo local");try{const e=yield navigator.mediaDevices.getUserMedia(o);this.gotStream(e)}catch(n){console.log("navigator.getUserMedia error: ",n)}})}gotStream(e){console.log("Fluxo local recebido"),this.localVideo.srcObject=e,this.localStream=e}createPeerConnection(){this.createPeerConnectionButton.disabled=!0,this.createOfferButton.disabled=!1,this.createAnswerButton.disabled=!1,this.setOfferButton.disabled=!1,this.setAnswerButton.disabled=!1,this.hangupButton.disabled=!1,console.log("Chamada inicial");const e=this.localStream.getVideoTracks(),t=this.localStream.getAudioTracks();e.length>0&&console.log("Usando dispositivo de v\xeddeo: "+e[0].label),t.length>0&&console.log("Usando dispositivo de \xe1udio: "+t[0].label),this.localPeerConnection=this.localPeerConnection=new RTCPeerConnection({iceServers:[]}),console.log("Objeto de conex\xe3o ponto a ponto local criado localPeerConnection"),this.localPeerConnection.onicecandidate=e=>this.onIceCandidate(this.localPeerConnection,e),this.sendChannel=this.localPeerConnection.createDataChannel("sendDataChannel",this.dataChannelOptions),this.sendChannel.onopen=this.onSendChannelStateChange,this.sendChannel.onclose=this.onSendChannelStateChange,this.sendChannel.onerror=this.onSendChannelStateChange,this.remotePeerConnection=this.remotePeerConnection=new RTCPeerConnection({iceServers:[]}),console.log("Criado objeto de conex\xe3o de ponto remoto remotePeerConnection"),this.remotePeerConnection.onicecandidate=e=>this.onIceCandidate(this.remotePeerConnection,e),this.remotePeerConnection.ontrack=this.gotRemoteStream,this.remotePeerConnection.ondatachannel=this.receiveChannelCallback,this.localStream.getTracks().forEach(e=>this.localPeerConnection.addTrack(e,this.localStream)),console.log("Adicionando stream local \xe0 conex\xe3o de par")}onSetSessionDescriptionSuccess(){console.log("Definir o sucesso da descri\xe7\xe3o da sess\xe3o.")}onSetSessionDescriptionError(e){console.log("Falha ao definir a descri\xe7\xe3o da sess\xe3o: "+e.toString())}createOffer(){var e;return Object(O.a)(this,void 0,void 0,function*(){try{const t=yield this.localPeerConnection.createOffer(this.offerOptions);this.gotDescription1(t),console.log(null===(e=t.sdp)||void 0===e?void 0:e.length)}catch(t){this.onCreateSessionDescriptionError(t)}})}onCreateSessionDescriptionError(e){console.log("Falha ao criar a descri\xe7\xe3o da sess\xe3o: "+e.toString())}setOffer(){var e;return Object(O.a)(this,void 0,void 0,function*(){const t=(null!==(e=this.offerSdp.value)&&void 0!==e?e:"").split("\n").map(e=>e.trim()).join("\r\n"),o={type:"offer",sdp:t};console.log("Oferta modificada de localPeerConnection\n"+t);try{yield this.localPeerConnection.setLocalDescription(o),this.onSetSessionDescriptionSuccess()}catch(n){this.onSetSessionDescriptionError(n)}try{yield this.remotePeerConnection.setRemoteDescription(o),this.onSetSessionDescriptionSuccess()}catch(n){this.onSetSessionDescriptionError(n)}})}gotDescription1(e){this.offerSdp.enable(),this.offerSdp.setValue(e.sdp?e.sdp:"")}createAnswer(){return Object(O.a)(this,void 0,void 0,function*(){try{const e=yield this.remotePeerConnection.createAnswer();this.gotDescription2(e)}catch(e){this.onCreateSessionDescriptionError(e)}})}setAnswer(){var e;return Object(O.a)(this,void 0,void 0,function*(){const t=(null!==(e=this.answerSdp.value)&&void 0!==e?e:"").split("\n").map(e=>e.trim()).join("\r\n"),o={type:"answer",sdp:t};try{yield this.remotePeerConnection.setLocalDescription(o),this.onSetSessionDescriptionSuccess()}catch(n){this.onSetSessionDescriptionError(n)}console.log("Resposta modificada de remotePeerConnection\n"+t);try{yield this.localPeerConnection.setRemoteDescription(o),this.onSetSessionDescriptionSuccess()}catch(n){this.onSetSessionDescriptionError(n)}})}gotDescription2(e){this.answerSdp.enable(),this.answerSdp.setValue(e.sdp?e.sdp:"")}sendData(){var e,t;"open"===(null===(e=this.sendChannel)||void 0===e?void 0:e.readyState)&&(null===(t=this.sendChannel)||void 0===t||t.send(""+this.dataChannelCounter),console.log("Contador de envio de DataChannel: "+this.dataChannelCounter),this.dataChannelCounter++)}hangup(){this.remoteVideo.srcObject=null,console.log("Terminando chamada"),this.localStream.getTracks().forEach(e=>e.stop()),this.sendChannel.close(),this.receiveChannel&&this.receiveChannel.close(),this.localPeerConnection.close(),this.remotePeerConnection.close(),Object.assign(this.localPeerConnection,null),Object.assign(this.remotePeerConnection,null),this.getMediaButton.disabled=!1,this.createPeerConnectionButton.disabled=!0,this.createOfferButton.disabled=!0,this.setOfferButton.disabled=!0,this.createAnswerButton.disabled=!0,this.setAnswerButton.disabled=!0,this.hangupButton.disabled=!0}getOtherPc(e){return e===this.localPeerConnection?this.remotePeerConnection:this.localPeerConnection}getName(e){return e===this.localPeerConnection?"localPeerConnection":"remotePeerConnection"}onAddIceCandidateSuccess(e){console.log("IceCandidate adicionado com sucesso.")}onAddIceCandidateError(e,t){console.log("Falha ao adicionar IceCandidate: "+(t?t.toString():""))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Fb({type:e,selectors:[["quertc-munge-sdp"]],viewQuery:function(e,t){if(1&e&&(s.Cc(M,!0),s.Cc(R,!0),s.Cc(k,!0),s.Cc(B,!0),s.Cc(x,!0),s.Cc(D,!0),s.Cc(_,!0),s.Cc(j,!0),s.Cc(A,!0),s.Cc(V,!0)),2&e){let e;s.kc(e=s.Yb())&&(t.getMediaButton=e.first),s.kc(e=s.Yb())&&(t.createPeerConnectionButton=e.first),s.kc(e=s.Yb())&&(t.createOfferButton=e.first),s.kc(e=s.Yb())&&(t.setOfferButton=e.first),s.kc(e=s.Yb())&&(t.createAnswerButton=e.first),s.kc(e=s.Yb())&&(t.setAnswerButton=e.first),s.kc(e=s.Yb())&&(t.hangupButton=e.first),s.kc(e=s.Yb())&&(t.localVideoRef=e.first),s.kc(e=s.Yb())&&(t.remoteVideoRef=e.first),s.kc(e=s.Yb())&&(t.selectSourceRef=e.first)}},decls:51,vars:4,consts:[["color","primary"],["label","Fonte de \xe1udio","kind","audioinput",3,"formControl"],["label","Fonte de v\xeddeo","kind","videoinput",3,"formControl"],["mat-raised-button","","color","primary","id","getMedia",3,"click"],["getMediaButtonRefButton",""],["mat-raised-button","","color","primary","id","createPeerConnection","disabled","",3,"click"],["createPeerConnectionRefButton",""],["mat-raised-button","","color","primary","id","createOffer","disabled","",3,"click"],["createOfferRefButton",""],["mat-raised-button","","color","primary","id","setOffer","disabled","",3,"click"],["setOfferRefButton",""],["mat-raised-button","","color","primary","id","createAnswer","disabled","",3,"click"],["createAnswerRefButton",""],["mat-raised-button","","color","primary","id","setAnswer","disabled","",3,"click"],["setAnswerRefButton",""],["mat-raised-button","","color","primary","id","hangup","disabled","",3,"click"],["hangupRefButton",""],["id","preview"],["mat-card-title","","for","localCandidate"],["playsinline","","autoplay","","muted",""],["localVideoRefEl",""],["appearance","outline"],["matInput","",3,"formControl"],["localTextarea",""],["mat-card-title","","for","remoteCandidate"],["playsinline","","autoplay",""],["remoteVideoRefEl",""],["remoteTextarea",""]],template:function(e,t){1&e&&(s.Qb(0,"mat-toolbar",0),s.Qb(1,"mat-toolbar-row"),s.Mb(2,"control-devices",1),s.Mb(3,"control-devices",2),s.Pb(),s.Qb(4,"mat-toolbar-row"),s.Qb(5,"button",3,4),s.Xb("click",function(){return t.getMedia()}),s.zc(7," M\xeddia "),s.Pb(),s.Qb(8,"button",5,6),s.Xb("click",function(){return t.createPeerConnection()}),s.zc(10," Conex\xe3o "),s.Pb(),s.Qb(11,"button",7,8),s.Xb("click",function(){return t.createOffer()}),s.zc(13," Criar oferta "),s.Pb(),s.Qb(14,"button",9,10),s.Xb("click",function(){return t.setOffer()}),s.zc(16," Ofertar "),s.Pb(),s.Qb(17,"button",11,12),s.Xb("click",function(){return t.createAnswer()}),s.zc(19," Criar resposta "),s.Pb(),s.Qb(20,"button",13,14),s.Xb("click",function(){return t.setAnswer()}),s.zc(22," Responder "),s.Pb(),s.Qb(23,"button",15,16),s.Xb("click",function(){return t.hangup()}),s.zc(25," Desligar "),s.Pb(),s.Pb(),s.Pb(),s.Qb(26,"div",17),s.Qb(27,"mat-card"),s.Qb(28,"label",18),s.zc(29,"Local "),s.Pb(),s.Mb(30,"video",19,20),s.Qb(32,"mat-form-field",21),s.Qb(33,"mat-label"),s.zc(34,"UID"),s.Pb(),s.Mb(35,"textarea",22,23),s.Qb(37,"mat-error"),s.zc(38,"Obrigat\xf3rio"),s.Pb(),s.Pb(),s.Pb(),s.Qb(39,"mat-card"),s.Qb(40,"label",24),s.zc(41,"Remoto "),s.Pb(),s.Mb(42,"video",25,26),s.Qb(44,"mat-form-field",21),s.Qb(45,"mat-label"),s.zc(46,"UID"),s.Pb(),s.Mb(47,"textarea",22,27),s.Qb(49,"mat-error"),s.zc(50,"Obrigat\xf3rio"),s.Pb(),s.Pb(),s.Pb(),s.Pb()),2&e&&(s.zb(2),s.gc("formControl",t.audioSource),s.zb(1),s.gc("formControl",t.videoSource),s.zb(32),s.gc("formControl",t.offerSdp),s.zb(12),s.gc("formControl",t.answerSdp))},directives:[r.a,r.c,y.a,d.l,d.e,a.b,P.a,P.f,p.c,p.f,S.a,d.b,p.b],styles:["[_nghost-%COMP%]{display:block;padding-bottom:64px;width:100%;--width:100%}[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{padding-right:60px;flex-direction:row}[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > .mat-toolbar-row[_ngcontent-%COMP%]:last-child{justify-content:flex-end}@media (max-width:720px){[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{padding-right:40px;flex-direction:column}[_nghost-%COMP%]   .mat-toolbar[_ngcontent-%COMP%] > .mat-toolbar-row[_ngcontent-%COMP%]:last-child{justify-content:space-between}}video[_ngcontent-%COMP%]{width:var(--width);height:calc(var(--width) * .75);-o-object-fit:cover;object-fit:cover;margin:0}#buttons[_ngcontent-%COMP%], #selectSource[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:8px 16px 16px}div#preview[_ngcontent-%COMP%]{display:flex;row-gap:8px;-moz-column-gap:8px;column-gap:8px;padding:8px}div#preview[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:100%}div#preview[_ngcontent-%COMP%] > .mat-card[_ngcontent-%COMP%]{display:inline-block;vertical-align:top;width:calc(50% - 32px)}div#preview[_ngcontent-%COMP%] > .mat-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;flex-direction:row}div#preview[_ngcontent-%COMP%] > .mat-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-right:12px}div#preview[_ngcontent-%COMP%] > .mat-card[_ngcontent-%COMP%] > video[_ngcontent-%COMP%]{width:100%}"]}),e})(),Q=(()=>{class e{}return e.\u0275mod=s.Jb({type:e}),e.\u0275inj=s.Ib({factory:function(t){return new(t||e)},imports:[[b.c,n.a,P.d,S.b,a.c,u,v,p.e,i.b,r.b,d.o,w.e.forChild([{path:"",component:I}])]]}),e})()}}]);