(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{zOaj:function(t,e,i){"use strict";i.r(e),i.d(e,"PerfectNegotiationComponent",function(){return C}),i.d(e,"PerfectNegotiationModule",function(){return _});var n=i("mrSG"),o=i("Huv7"),s=i("MAu8"),c=i("XNiG"),r=i("ikaO"),a=i("fXoL"),d=i("ofXK"),l=i("Wp6s"),u=i("bTqV"),h=i("Qu3c"),m=i("5RNC"),f=i("NFeN");function g(t,e){1&t&&(a.Qb(0,"mat-icon"),a.zc(1,"volume_off"),a.Pb())}function p(t,e){1&t&&(a.Qb(0,"mat-icon"),a.zc(1,"volume_mute"),a.Pb())}function b(t,e){1&t&&(a.Qb(0,"mat-icon"),a.zc(1,"volume_down"),a.Pb())}function v(t,e){1&t&&(a.Qb(0,"mat-icon"),a.zc(1,"volume_up"),a.Pb())}let w=(()=>{class t{constructor(){this._video=null,this.volume=1,this.volumeChanged=new a.n,this._muted=!1,this.mutedChanged=new a.n,this.keyboard=!0}get video(){return this._video}set video(t){this._video=t,this.video&&(this._muted=this.video.muted)}get muted(){return this._muted}set muted(t){this._muted=t,this.video&&(this.video.muted=this._muted)}setVolume(t){this.volume=t,this.video.volume=this.volume,this.volumeChanged.emit(this.volume),this.volume>0&&this.setMuted(!1)}setMuted(t){this.muted!==t&&this.toggleMuted()}toggleMuted(){this.muted=!this.muted,this.updateMuted()}updateMuted(){this.video.muted=this.muted,this.mutedChanged.emit(this.muted)}onMuteKey(t){this.keyboard&&(this.toggleMuted(),t.preventDefault())}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=a.Fb({type:t,selectors:[["quertc-mute-button"]],hostBindings:function(t,e){1&t&&a.Xb("keyup.m",function(t){return e.onMuteKey(t)},!1,a.nc)},inputs:{video:"video",volume:"volume",muted:"muted",keyboard:"keyboard"},outputs:{volumeChanged:"volumeChanged",mutedChanged:"mutedChanged"},decls:7,vars:4,consts:[[1,"volume-control"],["mat-icon-button","","matTooltip","Tecla M","aria-label","Use a tecla M para alternar o volume","matTooltipPosition","before",3,"click"],[4,"ngIf"],["min","0","max","1","step","0.01","value","1","color","primary",1,"volume-slider",3,"input"]],template:function(t,e){1&t&&(a.Qb(0,"div",0),a.Qb(1,"button",1),a.Xb("click",function(){return e.toggleMuted()}),a.xc(2,g,2,0,"mat-icon",2),a.xc(3,p,2,0,"mat-icon",2),a.xc(4,b,2,0,"mat-icon",2),a.xc(5,v,2,0,"mat-icon",2),a.Pb(),a.Qb(6,"mat-slider",3),a.Xb("input",function(t){return e.setVolume(t.value)}),a.Pb(),a.Pb()),2&t&&(a.zb(2),a.gc("ngIf",e.muted||0===e.volume),a.zb(1),a.gc("ngIf",!e.muted&&e.volume>0&&e.volume<.25),a.zb(1),a.gc("ngIf",!e.muted&&e.volume>=.25&&e.volume<.5),a.zb(1),a.gc("ngIf",!e.muted&&e.volume>=.5))},directives:[u.b,h.a,d.l,m.a,f.a],styles:[".volume-control[_ngcontent-%COMP%]{display:inline-block;min-width:120px;width:120px}.volume-slider[_ngcontent-%COMP%]{margin-left:-15px} .mat-slider-thumb{border-color:transparent} .mat-slider-track-background{background-color:#d3d3d3;transform:translateX(0)}.volume-control[_ngcontent-%COMP%]   .volume-slider[_ngcontent-%COMP%]{visibility:hidden;opacity:0;min-width:0;width:0;transition:visibility 0s .2s,opacity .2s linear,width .2s linear}.volume-control[_ngcontent-%COMP%]:hover   .volume-slider[_ngcontent-%COMP%]{visibility:visible;opacity:1;min-width:90px;width:90px;transition:opacity .2s linear,width .2s linear,min-width .2s linear}"]}),t})();var O=i("YVGP");const y=["selfView"],P=["remoteView"];function M(t,e){if(1&t&&(a.Qb(0,"div",7),a.Mb(1,"quertc-calling",8,9),a.cc(3,"async"),a.Pb()),2&t){const t=a.bc();a.zb(1),a.gc("active",!0===a.dc(3,1,t.active$))}}let C=(()=>{class t{constructor(t,e){this.signaling=t,this.stream=e,this.title="client-app",this.active=new c.a,this.active$=this.active.asObservable(),this.sender=Object(s.b)(),this.makingOffer=!1,this.ignoreOffer=!1,this.isSettingRemoteAnswerPending=!1,this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.start=()=>Object(n.a)(this,void 0,void 0,function*(){try{this.stream.currentStream=yield this.stream.getUserMedia();for(const t of this.stream.currentStream.getTracks())this.pc.addTrack(t,this.stream.currentStream);this.selfView.srcObject=this.stream.currentStream,this.selfView.muted=!0}catch(t){console.error(t)}}),this.restart=()=>Object(n.a)(this,void 0,void 0,function*(){this.offerOptions.iceRestart=!0,this.makeOffer(this.offerOptions)})}makeOffer(t){return Object(n.a)(this,void 0,void 0,function*(){try{this.makingOffer=!0,yield this.pc.setLocalDescription(yield this.pc.createOffer(t)),this.pc.localDescription&&this.signaling.send({sender:this.sender,description:this.pc.localDescription})}catch(e){console.error(e)}finally{this.makingOffer=!1}})}ngAfterViewInit(){this.selfView=this.selfViewRef.nativeElement,this.remoteView=this.remoteViewRef.nativeElement,this.pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.stunprotocol.org:3478"}]}),this.pc.addEventListener("track",({track:t,streams:e})=>{t.addEventListener("unmute",()=>{this.remoteView.srcObject||(this.remoteView.srcObject=e[0],this.active.next(!0))})}),this.pc.addEventListener("icecandidate",({candidate:t})=>{t&&this.signaling.send({sender:this.sender,candidate:t})}),this.pc.addEventListener("negotiationneeded",()=>Object(n.a)(this,void 0,void 0,function*(){this.makeOffer(this.offerOptions)})),this.subs=this.signaling.message$.subscribe(({sender:t,description:e,candidate:i})=>Object(n.a)(this,void 0,void 0,function*(){console.log("sender: ",t);try{if(e){const i=!this.makingOffer&&("stable"==this.pc.signalingState||this.isSettingRemoteAnswerPending),n=e.type==o.b.Offer&&!i;if(this.ignoreOffer=t===this.sender&&n,this.ignoreOffer)return;this.isSettingRemoteAnswerPending=e.type==o.b.Answer,yield this.pc.setRemoteDescription(e),this.isSettingRemoteAnswerPending=!1,e.type==o.b.Offer&&(yield this.pc.setLocalDescription(yield this.pc.createAnswer()),this.pc.localDescription&&this.signaling.send({description:this.pc.localDescription}))}else if(i)try{yield this.pc.addIceCandidate(i)}catch(n){if(!this.ignoreOffer)throw n}}catch(n){console.error(n)}})),this.start()}hangup(){console.log("Ending call"),this.stream.currentStream.getTracks().forEach(t=>t.stop()),this.pc&&(this.pc.close(),Object.defineProperties(this.pc,{}))}ngOnDestroy(){this.hangup(),this.subs&&this.subs.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(a.Lb(o.d),a.Lb(r.b))},t.\u0275cmp=a.Fb({type:t,selectors:[["quertc-perfect-negotiation"]],viewQuery:function(t,e){if(1&t&&(a.Cc(r.a,!0),a.Cc(y,!0),a.Cc(P,!0)),2&t){let t;a.kc(t=a.Yb())&&(e.calling=t.first),a.kc(t=a.Yb())&&(e.selfViewRef=t.first),a.kc(t=a.Yb())&&(e.remoteViewRef=t.first)}},decls:10,vars:4,consts:[["class","center",4,"ngIf"],["id","remote"],["autoplay",""],["remoteView",""],["id","local"],["selfView",""],[3,"video"],[1,"center"],[3,"active"],["calling",""]],template:function(t,e){if(1&t&&(a.xc(0,M,4,3,"div",0),a.cc(1,"async"),a.Qb(2,"div",1),a.Mb(3,"video",2,3),a.Pb(),a.Qb(5,"mat-card",4),a.Mb(6,"video",2,5),a.Qb(8,"mat-card-actions"),a.Mb(9,"quertc-mute-button",6),a.Pb(),a.Pb()),2&t){const t=a.lc(7);a.gc("ngIf",null===a.dc(1,2,e.active$)),a.zb(9),a.gc("video",t)}},directives:[d.l,l.a,l.b,w,O.a],pipes:[d.b],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}[_nghost-%COMP%]   .center[_ngcontent-%COMP%]{position:absolute;text-align:center;max-width:150px}[_nghost-%COMP%]   .center[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:16px;line-height:1.2}#remote[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}#remote[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:100vw;height:100%;-o-object-fit:cover;object-fit:cover}#local[_ngcontent-%COMP%]{right:4px;width:240px;height:auto;max-width:240px;border-radius:8px;overflow:hidden;position:fixed;padding:0;bottom:4px}#local[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:inherit;height:auto;-o-object-fit:cover;object-fit:cover;margin-bottom:-8px}#local[_ngcontent-%COMP%]   .mat-card-actions[_ngcontent-%COMP%]{position:absolute;bottom:0;margin:0 6px -3px;z-index:10;color:#fff}#self[_ngcontent-%COMP%]{position:fixed;bottom:0;right:0;border-radius:50%;overflow:hidden;width:150px;height:150px;display:flex;align-items:center;justify-content:center;border:3px solid #fff;border-radius:100%}#self[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:auto;height:154px;-o-object-fit:contain;object-fit:contain}"]}),t})();var x=i("tyNb");let _=(()=>{class t{}return t.\u0275mod=a.Jb({type:t}),t.\u0275inj=a.Ib({factory:function(e){return new(e||t)},imports:[[d.c,r.c,l.d,x.e.forChild([{path:"",component:C}])]]}),t})()}}]);